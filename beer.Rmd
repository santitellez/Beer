---
title: "Craft Beer"
author: "Santiago Tellez"
date: "1/25/2019"
output: pdf_document
---

#Loading Packages
```{r, echo=FALSE, warning=FALSE, message=FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load('stringr',
               'knitr',
               'ggplot2',
               'astsa',
               'lubridate',
               'ggmap',
               'maps',
               'mapdata',
               'dplyr')
```

#Loading Data
```{r, echo=FALSE}
opts_knit$set(root.dir = normalizePath("../"))

beers <- read.csv("craft-cans/beers.csv", stringsAsFactors = FALSE)
breweries <- read.csv("craft-cans/breweries.csv", stringsAsFactors = FALSE)

beers_and_brewery <- merge(beers, breweries, by.x = "brewery_id", by.y = "X")
```

#Feature Creation
```{r, echo=FALSE}
beers_and_brewery$ratio <- scale(beers_and_brewery$ibu) / scale(beers_and_brewery$abv)
```

#EDA
```{r, echo=FALSE}
abv_hist <- 
```

#Label Creation
```{r, echo=FALSE}
beers_and_brewery$type <- NA
beers_and_brewery$type[which(grepl("Ale", beers_and_brewery$style))] <- "ale"
beers_and_brewery$type[which(grepl("IPA", beers_and_brewery$style))] <- "ale"
beers_and_brewery$type[which(grepl("Lager", beers_and_brewery$style))] <- "lager"
beers_and_brewery$type[which(grepl("Stout", beers_and_brewery$style))] <- "stout"
beers_and_brewery$type[which(grepl("Porter", beers_and_brewery$style))] <- "stout"
beers_and_brewery$type[which(grepl("Malt", beers_and_brewery$style))] <- "malt"
beers_and_brewery$type[which(grepl("KÃ¶lsch", beers_and_brewery$style))] <- "lager"
beers_and_brewery$type[which(grepl("Pilsner", beers_and_brewery$style))] <- "lager"
beers_and_brewery$type[which(grepl("Pilsener", beers_and_brewery$style))] <- "lager"
beers_and_brewery$type[which(grepl("Fruit", beers_and_brewery$style))] <- "other"
beers_and_brewery$type[which(grepl("Cider", beers_and_brewery$style))] <- "cider"
beers_and_brewery$type[which(grepl("Witbier", beers_and_brewery$style))] <- "other"
beers_and_brewery$type[which(grepl("Rye", beers_and_brewery$style))] <- "malt"
beers_and_brewery$type[which(grepl("Hefeweizen", beers_and_brewery$style))] <- "malt"
beers_and_brewery$type[which(is.na(beers_and_brewery$type))] <- "other"
```

#ABV and IBU by Type of Beer
```{r, echo=FALSE}
type_by_abv_and_ibu <- ggplot(data = beers_and_brewery) +
  geom_point(aes(abv, ibu, color = type))
```

#Beer Stats by Brewery
```{r, echo=FALSE, warning=FALSE, message=FALSE}
avg_brewery <- aggregate(beers_and_brewery, list(Brewery = beers_and_brewery$name.y), FUN = mean, na.action = na.omit)
avg_state <- aggregate(beers_and_brewery, list(Brewery = beers_and_brewery$state), FUN = mean, na.action = na.omit)
```

#Maps
```{r, echo=FALSE, message=FALSE, warning=FALSE}
state_index <- as.data.frame(cbind(as.character(state.abb), 
                                   tolower(as.character(state.name)), 
                                   as.character(state.region)))
colnames(state_index) <- c("state", "region", "area")
state_index$state <- as.character(state_index$state)
state_index$region <- as.character(state_index$region)

states <- map_data("state")
states <- left_join(states, state_index)
beers_and_brewery$state <- gsub(" ", "", beers_and_brewery$state)
states <- left_join(states, beers_and_brewery)

states_abv <- ggplot(data = states) + 
  geom_polygon(aes(x = long, y = lat, fill = area, group = group), color = "white") + 
  coord_fixed(1.275) +
  guides(fill = FALSE)
```



